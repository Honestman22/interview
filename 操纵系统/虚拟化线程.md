## 第6章 时钟中断
操作系统面临 性能和控制权的问题
### 1，性能问题，为了避免某一个程序完全控制系统,让其他程序难以运行，操作系统采用受限制的操作，

1 基本思路,t提供不同的模式，用户模式，内核模式
用户模式不能完全访问机器的资源，
内核模式可以完全访问系统的；，如果用户模式需要完全访问机器资源骂他智能陷入内核，也就是 用户态和内核态的切换；
用户把程序计数器保存到内核栈，然后内核模式执行系统调用，的调用完内核栈恢复子村企，返回用户模式

2，控制权问题
操作系统不会把所有控制权交给程序， 通过启动一个时间中断程序，中断当前进程，讲进程的寄存器保存到对应的进程结构，然后恢复另一个进程的结构，放到内核栈，
就像刚刚所说的内核态用户态切换，切换基于进程调度算法

#### 新的问题
 如果在处理一个中断时，发生了另一个中断，一般会使用加锁的方式
 
 ## 第7章 进程调度
 进程调度是指在操作系统发生时钟中断时，如何调度运行其他的进程
 
 第一个 性能指标： T周转时间=T完成时间-T到达时间
 
 在性能指标考量下，FIFO ,SJF 最短时间优先(在假设所有任务同时到达的情况下)，STCF(根据最短完成时间 ，抢占式),   STCF 很满足周转时间这个指标

 第二个 性能指标 T响应时间=T首次运行-T到达时间
  RR  时间片轮转 (时间片用完就切换另一个进程，时间片一般时时钟中断的倍数，时间片太短会导致进程切换太频繁，影响整体性能， 太长又会影响相应性能)
 提示：进程山下文切换慢，除了保存和恢复寄存器外，还有cpu缓存，和tlb（内存映射）缓存的刷新，分支预测器（这个不太懂） 刷新；
 
####  T周转时间 和 T周转时间 不能兼得


 ## 第8，9章 多级反馈队列 和 比例份额
 多级反馈队列的基本原理，内部维护多个有优先级的队列，一级队列有个时间片，运行完之后就到低优先级，操作系统始终运行最高优先级的任务，为了避免饥饿问题，经过一段时间会将所有任务提升到最高优先级
 
 #### 新的问题 配置多少队列。每一层队列配置多少时间片， 这个鱼和熊掌不能兼得的问题 就是”巫毒常量“
 
   比例份额 为了实现不公平的调度，
   
   实现机制 1，利用随机性(问题是如果在运行时间短的形况下，误差时较大的，只有在大数据量形况下，随机性才能表现得好)
   实现机制 2， 利用特定步长 。步长10 20 30，运行行程最短的（）
 
 ####   对比，如果新加入了线程，其他步长已经走得很远了，这个线程如何加入，这点利用随机性可以满足

## 第10章 多处理器调度
   现代操作系统都是多个cpu，面临的问题
    缓存的局部性有两种（时间局部性（访问过一次的后面大概率会多次访问），空间局部性（访问数组索引在0的位置，大概率很访问索引在1的位置））
  1，缓存一致性问题，cpu缓存结构大冬之，存在一种总线窥探的技术解决（还有其他的没有详细说明）
  2，同步，如果同时操作内存需要枷锁
  3，缓存亲和度，一个进程任务始终在同一个cpu上运行，例如netty的串行无锁化
  
  #####  问题解决1 单队列多处理器调度，
   所有需要调度的工作 都放在一个队列，多有cpu从队列里取
   优点：实现简单
  新的问题1，扩展性不好，任务太多 放在要给队列，无法扩展
        2，需要做同步控制，也会损耗性能
        3，缓存亲和度智能满足一部分
   #####  问题解决2 多队列多处理器调度，
       有几个cpu就维护几个队列，单独处理自己的
       优点: 扩展性好，缓存亲和度高
       存在问题 负载不均（一个队列里处理完了，只能干等着？）工作窃取？多久窃取一次，这是这个方式最大的痛点

   ##### 现况： 目前存在单队列多处理器，也存在多队列多处理器调度，调度算法时多级反馈队列和比例份额

## 第11章
 
 
 
 
 
 
 
 
