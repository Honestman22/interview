 架构
 ====

## 用java自己实现一个LRU。
第一种
继承linkedHashMap，
1，调用该初始化方法，
accessOrder为true时，最近访问的会放在最前面
public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) {
        super(initialCapacity, loadFactor);
        this.accessOrder = accessOrder;
},
2，重写removeEldestEntry（）方法，该方法在每次插入数据后进行调用，默认返回false；，重写后改为
return size（）> cachSize();

第二种hashmap + 链表

## 分布式集群下如何做到唯一序列号。
当前时间加自增序号
1、 数据库自增长序列或字段

2、UUID 性能好

3，Redis生成ID

4，Twitter的snowflake算法

5，zookeeper

## 设计一个秒杀系统，30分钟没付款就自动关闭交易。
redis过期回调，
mq延迟队列消息到期未消费进入死信队列？；

## 如何使用redis和zookeeper实现分布式锁？有什么区别优缺点，会有什么问题，分别适用什么场景。（延伸：如果知道redlock，讲讲他的算法实现，争议在哪里）
使用缓存实现分布式锁的优点

性能好，实现起来较为方便。

使用缓存实现分布式锁的缺点

通过超时时间来控制锁的失效时间并不是十分的靠谱。如果宕机重启，线程可能会白等一段时间，

zookeeper稳定；还可以实现公平锁

从实现的复杂性角度（从低到高）
Zookeeper >= 缓存 > 数据库

从性能角度（从高到低）
缓存 > Zookeeper >= 数据库

从可靠性角度（从高到低）
Zookeeper > 缓存 > 数据库

http://www.hollischuang.com/archives/1716
## 如果有人恶意创建非法连接，怎么解决。
暂时认为非法链接是url不存在的链接，冲击服务器

在Nginx这一层做过滤，布隆过滤

## 分布式事务的原理，优缺点，如何使用分布式事务，2pc 3pc 的区别，解决了哪些问题，还有哪些问题没解决，如何解决，你自己项目里涉及到分布式事务是怎么处理的。

 3pc 比2pc多了一个缓冲，主要解决了，如果协调者挂了，参与者不会一直阻塞，等待接收commit或者rollback的通知，而是会超时commit；可能不一致
 
 tcc，mq；
 
## 什么是一致性hash。
2^32次的环形hash
## 什么是restful，讲讲你理解的restful。

http +json，get是读，post是提交，put是存，delete是删除，一个url代表一直资源
## 如何设计一个良好的API。
，要有版本号，v0

200	请求成功
201	创建成功
400	错误的请求
401	未验证
403	被拒绝
404	无法找到
409	资源冲突
500	服务器内部错误
## 如何设计建立和保持100w的长连接。
服务器内核调优(tcp，文件数)，客户端调优，框架选择(netty nio)

服务器配置
一般服务器默认限制1024个文件句柄 也就是最多支持1024并发长连接 在root用户下编辑 /etc/security/limits.conf文件
soft nofile 1048576
hard nofile 1048576  单个进程最多100万链接
.soft是一个警告值 而hard则是一个真正意义的阈值 超过就会报错
.hard 指的是当前系统生效的设置值 hard表明系统中所能设定的最大值
.nofile -单进程打开文件的最大数目

端口范围扩大  net.ipv4.ip_local_port_range= 1024 65535  

添加fs.file-max = 1048576  ，系统所有进程允许同时打开的，最多文件数

net.ipv4.tcp_mem= 786432 2097152 3145728  ，单位页，一页4kb，超过最大时，进程被杀死
net.ipv4.tcp_rmem= 4096 4096 16777216  
net.ipv4.tcp_wmem= 4096 4096 16777216  
net.ipv4.tcp_max_orphans =131072   socket连接会进入队列排队，这种是orphans socket，防止报错too many orphans socket

https://blog.csdn.net/lijinqi1987/article/details/74545851?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2
## 解释什么是MESI协议(缓存一致性)。
M:modified 修改的

E:exclusive 独享的

S:shared 共享的

I:invalid 无效的

修改会将其他cpu里的缓存数据置位无效，

那为什么cpu缓存一致性协议，java还要valitle解决呢
1，可见性，因为cpu将其他缓存置位无效并不是实时同步的，一个cpu在更改数据后，存入storebuffer后发送invalidate消息后，再没收到ack，是不会提交到主存，
这个短暂的延迟，其他cpu进来读取就会读取到旧的数据，解决这个问题就是valitle加读内存屏障，告诉cpu读数据之前先应用无效队列里的无效指令
2，指令重排序，指令是顺序执行的，但执行结果不是按顺序来的，因为当cpu写第一条数据时，其他cpu里也有，数据生效就会慢，写第二条数据，其他cpu里没有，这条数据很快生效，所以造成第二条数据比第一条慢；这里加volatile加入写屏障，告诉处理器 执行这个写屏障指令之前，执行storebuffer里的所有保存操作！

## 说说你知道的几种HASH算法，简单的也可以。
## 什么是paxos算法， 什么是zab协议。
## 一个在线文档系统，文档可以被编辑，如何防止多人同时对同
## 一份文档进行编辑更新。
## 线上系统突然变得异常缓慢，你如何查找问题。
## 说说你平时用到的设计模式。
## Dubbo的原理，有看过源码么，数据怎么流转的，怎么实现集群，负载均衡，服务注册
## 和发现，重试转发，快速失败的策略是怎样的 。
## 一次RPC请求的流程是什么。
## 自己实现过rpc么，原理可以简单讲讲。Rpc要解决什么问题。
## 异步模式的用途和意义。
## 编程中自己都怎么考虑一些设计原则的，比如开闭原则，以及在工作中的应用。
## 设计一个社交网站中的“私信”功能，要求高并发、可扩展等等。 画一下架构图。
## MVC模式，即常见的MVC框架。
## 聊下曾经参与设计的服务器架构并画图，谈谈遇到的问题，怎么解决的。
## 应用服务器怎么监控性能，各种方式的区别。
## 如何设计一套高并发支付方案，架构如何设计。
## 如何实现负载均衡，有哪些算法可以实现。
## Zookeeper的用途，选举的原理是什么。
## Zookeeper watch机制原理。
## Mybatis的底层实现原理。
## 请思考一个方案，实现分布式环境下的countDownLatch。
## 后台系统怎么防止请求重复提交。
## 描述一个服务从发布到被消费的详细过程。
## 讲讲你理解的服务治理。
## 如何做到接口的幂等性。
## 如何做限流策略，令牌桶和漏斗算法的使用场景。
## 什么叫数据一致性，你怎么理解数据一致性。
## 分布式服务调用方，不依赖服务提供方的话，怎么处理服务方挂掉后，大量无效资源请求
## 的浪费，如果只是服务提供方吞吐不高的时候该怎么做，如果服务挂了，那么一会重启，该怎
## 么做到最小的资源浪费，流量半开的实现机制是什么。
## dubbo的泛化调用怎么实现的，如果是你，你会怎么做。
## 远程调用会有超时现象，如果做到优雅的控制，JDK自带的超时机制有哪些，怎么实现的
